<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Inscription DIGIY HUB ‚Äî 0% Commission</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Styles DIGIY -->
  <style>
    :root{
      --bg:#020617;
      --bg-soft:#030712;
      --card:#020617;
      --accent:#facc15;
      --accent-soft:rgba(250,204,21,0.12);
      --text:#e5e7eb;
      --muted:#9ca3af;
      --danger:#f97373;
      --success:#22c55e;
      --border:#1f2937;
      --input-bg:#020617;
    }

    body{
      margin:0;
      padding:0;
      background:radial-gradient(circle at top,#111827 0,#020617 55%);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Manrope","Outfit",sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:20px;
    }

    .page{
      width:100%;
      max-width:480px;
    }

    .logo{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin-bottom:20px;
    }
    .logo-icon{
      width:46px;
      height:46px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background:radial-gradient(circle at 30% 0,#facc15 0,transparent 55%);
      border:1px solid rgba(250,204,21,0.5);
      color:#111827;
      font-size:22px;
      font-weight:800;
    }
    .logo-text{
      text-transform:uppercase;
      font-size:14px;
      letter-spacing:0.12em;
      color:var(--muted);
      font-weight:700;
    }

    .card{
      background:linear-gradient(145deg,rgba(15,23,42,0.98),rgba(2,6,23,0.98));
      border-radius:24px;
      border:1px solid rgba(148,163,184,0.18);
      padding:24px 20px 22px;
      box-shadow:0 24px 60px rgba(0,0,0,0.75);
      backdrop-filter:blur(16px);
    }

    h1{
      margin:0 0 6px;
      text-align:center;
      font-size:22px;
      text-transform:uppercase;
      letter-spacing:0.08em;
      font-weight:800;
    }
    h1 .accent{
      color:var(--accent);
      text-shadow:0 0 18px rgba(250,204,21,0.45);
    }
    .subtitle{
      text-align:center;
      color:var(--muted);
      font-size:13px;
      margin-bottom:14px;
    }

    .pill-row{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:center;
      margin-bottom:18px;
    }
    .pill{
      padding:5px 12px;
      border-radius:999px;
      font-size:11px;
      border:1px solid rgba(148,163,184,0.3);
      background:rgba(15,23,42,0.9);
      color:var(--muted);
      display:flex;
      gap:4px;
      align-items:center;
    }
    .pill i{
      color:var(--accent);
      font-style:normal;
    }

    form{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    label{
      font-size:12px;
      color:var(--muted);
      font-weight:500;
      letter-spacing:0.05em;
      text-transform:uppercase;
      margin-bottom:4px;
    }
    .required::after{
      content:"*";
      color:var(--accent);
      margin-left:4px;
    }

    input, select{
      padding:12px 14px;
      width:100%;
      border-radius:12px;
      border:1px solid var(--border);
      background:var(--input-bg);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    input:focus, select:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(250,204,21,0.4);
    }

    button{
      margin-top:10px;
      padding:14px;
      border-radius:999px;
      border:none;
      font-size:14px;
      font-weight:700;
      background:linear-gradient(135deg,#facc15,#eab308);
      color:#111827;
      cursor:pointer;
      text-transform:uppercase;
      letter-spacing:0.12em;
      display:flex;
      gap:8px;
      justify-content:center;
      box-shadow:0 10px 26px rgba(250,204,21,0.45);
    }
    button:disabled{
      opacity:0.7;
      cursor:not-allowed;
    }

    #status{
      font-size:13px;
      margin-top:6px;
      min-height:18px;
      text-align:center;
    }
    .error{color:var(--danger);}
    .success{color:var(--success);}
  </style>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
  <div class="page">
    <div class="logo">
      <div class="logo-icon">ü¶Ö</div>
      <div class="logo-text">DIGIY HUB</div>
    </div>

    <div class="card">
      <h1><span class="accent">Inscription</span> DIGIY</h1>
      <div class="subtitle">
        Une seule fiche. Tous tes modules DIGIY (Driver, Loc, Resto, Market, Jobs‚Ä¶)
      </div>

      <div class="pill-row">
        <div class="pill"><i>‚úì</i> 0% commission</div>
        <div class="pill"><i>‚úì</i> Paiement direct</div>
        <div class="pill"><i>‚úì</i> Donn√©es souveraines</div>
      </div>

      <form id="form">
        <div>
          <label class="required">Nom complet</label>
          <input id="fullName" required placeholder="Ex. Fatou Ndiaye">
        </div>

        <div>
          <label class="required">T√©l√©phone</label>
          <input id="phone" required placeholder="+221 77 000 00 00">
        </div>

        <div>
          <label class="required">Pays</label>
          <input id="country" required value="S√©n√©gal">
        </div>

        <div>
          <label class="required">Email de connexion</label>
          <input id="email" type="email" required placeholder="exemple@domaine.com">
        </div>

        <div>
          <label class="required">Module principal</label>
          <select id="mainModule" required>
            <option value="">‚Äî Choisir ‚Äî</option>
            <option value="driver">DIGIY DRIVER</option>
            <option value="loc">DIGIY LOC</option>
            <option value="resto">DIGIY RESTO</option>
            <option value="market">DIGIY MARKET</option>
            <option value="jobs">DIGIY JOBS</option>
            <option value="multi">Pack Multi-modules</option>
          </select>
        </div>

        <div>
          <label>Notes (optionnel)</label>
          <input id="notes" placeholder="Ex. 2 maisons √† louer √† Saly‚Ä¶">
        </div>

        <button type="submit" id="btn">
          ü¶Ö Rejoindre DIGIY
        </button>

        <div id="status"></div>
      </form>
    </div>
  </div>

<script>
    // CONFIG SUPABASE
    const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

    // Lien o√π le mail magique Supabase doit envoyer
    const REDIRECT_URL = "https://beauville.github.io/mon-espace-digiy/";

    const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const form = document.getElementById("form");
    const statusEl = document.getElementById("status");
    const btn = document.getElementById("btn");

    function setStatus(msg, type){
      statusEl.textContent = msg;
      statusEl.className = type;
    }

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      setStatus("");
      btn.disabled = true;

      const fullName = fullName.value.trim();
      const phone = phone.value.trim();
      const country = country.value.trim();
      const email = email.value.trim().toLowerCase();
      const mainModule = mainModule.value;
      const notes = notes.value.trim();

      // Enregistrement Supabase
      const { error: insertErr } = await client
        .from("pre_registrations")
        .insert([{
          full_name: fullName,
          phone,
          whatsapp: phone,
          country,
          email,
          preferred_module: mainModule,
          modules: [mainModule],
          notes,
          status: "pre_registered",
          source: "inscription-github",
          created_at: new Date().toISOString()
        }]);

      if(insertErr){
        console.error(insertErr);
        setStatus("Erreur enregistrement : " + insertErr.message, "error");
      } else {
        setStatus("Fiche enregistr√©e ‚úîÔ∏è Envoi du lien magique‚Ä¶", "success");
      }

      // Lien magique Supabase
      const { error: authErr } = await client.auth.signInWithOtp({
        email,
        options:{ emailRedirectTo: REDIRECT_URL }
      });

      if(authErr){
        console.error(authErr);
        setStatus("Erreur email : " + authErr.message, "error");
      } else {
        setStatus("üéâ V√©rifie ton email pour ouvrir ton HUB DIGIY.", "success");
        form.reset();
      }

      btn.disabled = false;
    });
</script>

</body>
</html>
